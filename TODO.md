## 回声 (Echo) v2.3 - TODO 任务清单

### 阶段一：基础后端化（Firebase）
- [ ] Firebase 初始化配置
  - 创建 Firebase 项目、启用 Authentication 与 Firestore
  - 在前端接入 SDK（module 方式）并配置 `.env`/常量占位
  - 验收：可在浏览器控制台看到 `firebase.initializeApp` 成功，无错误日志
- [ ] 用户认证（Email/Password）
  - 登录/注册/退出逻辑与 UI（复用右上角登录按钮）
  - 登录态管理（state.user）与受控渲染
  - 验收：新用户可注册登录，刷新后仍保持登录态
- [ ] Firestore 数据模型与读写
  - 集合：`users/{uid}/sparks`、`users/{uid}/creations`、`users/{uid}/settings`
  - 将 `saveState()/loadState()` 迁移为云端读写（保持最小改动）
  - 验收：新增火花/创作在 Firestore 可见，换设备登录可同步
- [ ] 实时同步
  - 使用 `onSnapshot` 监听集合变化，自动刷新列表
  - 验收：在两个浏览器同时登录，同步新增/修改/删除
- [ ] 数据迁移脚本
  - 从 localStorage 一键上云（仅一次性），迁移后清理本地冗余键
  - 验收：迁移后所有历史数据与结构保持一致

### 阶段二：功能增强
- [ ] 标签系统
  - 火花/创作支持多标签（轻量输入+下拉联想）
  - 过滤与按标签统计
  - 验收：可创建/编辑/过滤标签，状态持久化
- [ ] 数据导出
  - 一键导出 JSON / Markdown（按日期与标签组织）
  - 验收：下载的文件内容完整、可被重新导入
- [ ] 历史视图增强
  - 日历日格提示数量、详情视图支持跳转到编辑
  - 验收：从日历可直达具体火花/创作编辑

### 阶段三：体验优化
- [ ] UI 优化
  - 细化空状态与加载、错误提示（toast）
  - 键盘交互（Enter 添加、Esc 关闭、Cmd/Ctrl+S 保存）
  - 验收：主要操作有清晰反馈，关键路径可键盘完成
- [ ] 主题与可访问性
  - 明暗主题切换、对比度与可读性检查
  - 验收：AA 对比度通过，主题切换可持久化

### 阶段四：通知与自动化
- [ ] 真正的邮件提醒
  - 选型（SendGrid/Cloud Functions + 邮件服务）
  - 定时任务根据 `settings.reminderTime` 发送今日待办
  - 验收：在真实邮箱收到提醒，日志可追踪
- [ ] 链接元数据抓取（Cloud Functions）
  - 粘贴 URL 自动补全标题/描述/站点图标
  - 验收：添加火花时可见元数据，失败有降级

### 阶段五：测试与文档
- [ ] 基础测试
  - 核心函数单元测试（数据格式、排序、过滤）
  - 关键流程集成测试（添加->回响->创作->保存）
  - 验收：CI 通过，核心路径无回归
- [ ] 端到端测试
  - 登录->添加火花->添加回响->启发创作->保存->导出
  - 验收：E2E 脚本稳定通过
- [ ] 文档
  - 用户指南（快速上手、FAQ）
  - 开发文档（架构、数据模型、约定）
  - 验收：新同学 30 分钟能跑起来并做一次发布

---

### 技术要点与约定
- 状态对象 `state` 保持原接口，逐步把读写替换为 Firestore
- 先实现“登录后才读云端数据”，未登录仍可用本地模式
- 保留 `APP_STORAGE_KEY`，用于迁移与离线兜底
- 任何破坏性改动需提供一次性迁移与回滚策略
